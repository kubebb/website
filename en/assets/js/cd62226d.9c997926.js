"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2050],{3905:(e,t,n)=>{n.d(t,{Zo:()=>i,kt:()=>k});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var o=r.createContext({}),u=function(e){var t=r.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},i=function(e){var t=u(e.components);return r.createElement(o.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,o=e.parentName,i=c(e,["components","mdxType","originalType","parentName"]),p=u(n),d=a,k=p["".concat(o,".").concat(d)]||p[d]||m[d]||s;return n?r.createElement(k,l(l({ref:t},i),{},{components:n})):r.createElement(k,l({ref:t},i))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,l=new Array(s);l[0]=d;var c={};for(var o in t)hasOwnProperty.call(t,o)&&(c[o]=t[o]);c.originalType=e,c[p]="string"==typeof e?e:a,l[1]=c;for(var u=2;u<s;u++)l[u]=n[u];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},841:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>m,frontMatter:()=>s,metadata:()=>c,toc:()=>u});var r=n(7462),a=(n(7294),n(3905));const s={sidebar_position:8},l="\u6dfb\u52a0\u96c6\u7fa4",c={unversionedId:"quick-start/add-cluster",id:"quick-start/add-cluster",title:"\u6dfb\u52a0\u96c6\u7fa4",description:"\u6dfb\u52a0\u7ba1\u7406\u96c6\u7fa4",source:"@site/docs/quick-start/add-cluster.md",sourceDirName:"quick-start",slug:"/quick-start/add-cluster",permalink:"/website/en/docs/quick-start/add-cluster",draft:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"\u79c1\u6709\u96c6\u7fa4\u90e8\u7f72\u65b9\u6848",permalink:"/website/en/docs/quick-start/privatecluster"},next:{title:"\u7ec4\u4ef6\u7ba1\u7406",permalink:"/website/en/docs/user-guide/component_anagement"}},o={},u=[{value:"\u6dfb\u52a0\u7ba1\u7406\u96c6\u7fa4",id:"\u6dfb\u52a0\u7ba1\u7406\u96c6\u7fa4",level:2},{value:"\u6dfb\u52a0\u6258\u7ba1\u96c6\u7fa4",id:"\u6dfb\u52a0\u6258\u7ba1\u96c6\u7fa4",level:2},{value:"2.1 \u57fa\u7840\u96c6\u7fa4\u7ec4\u4ef6\u90e8\u7f72",id:"21-\u57fa\u7840\u96c6\u7fa4\u7ec4\u4ef6\u90e8\u7f72",level:3},{value:"2.2 \u90e8\u7f72\u79df\u6237\u7ec4\u4ef6",id:"22-\u90e8\u7f72\u79df\u6237\u7ec4\u4ef6",level:3},{value:"2.3 \u6dfb\u52a0\u96c6\u7fa4",id:"23-\u6dfb\u52a0\u96c6\u7fa4",level:3}],i={toc:u},p="wrapper";function m(e){let{components:t,...n}=e;return(0,a.kt)(p,(0,r.Z)({},i,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"\u6dfb\u52a0\u96c6\u7fa4"},"\u6dfb\u52a0\u96c6\u7fa4"),(0,a.kt)("h2",{id:"\u6dfb\u52a0\u7ba1\u7406\u96c6\u7fa4"},"\u6dfb\u52a0\u7ba1\u7406\u96c6\u7fa4"),(0,a.kt)("p",null,"\u524d\u63d0\uff1a\u5df2\u7ecf\u6309\u7167",(0,a.kt)("a",{parentName:"p",href:"/website/en/docs/quick-start/quick-install"},"\u5b89\u88c5\u5e95\u5ea7")," \u5b8c\u6210\u5e95\u5ea7\u7684\u90e8\u7f72"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u4e3a\u96c6\u7fa4\u7ba1\u7406\u521b\u5efa\u4e00\u4e2a namespace\uff0c\u53ef\u4ee5\u4f7f\u7528 cluster-system\uff0c\u7528\u6765\u4fdd\u5b58\u96c6\u7fa4\u4fe1\u606f")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"kubectl create ns cluster-system\n")),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},"\u83b7\u53d6\u6dfb\u52a0\u96c6\u7fa4\u7684 token")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"export TOKENNAME=$(kubectl get serviceaccount/host-cluster-reader -n u4a-system -o jsonpath='{.secrets[0].name}')\nkubectl get secret $TOKENNAME -n u4a-system -o jsonpath='{.data.token}' | base64 -d\n")),(0,a.kt)("ol",{start:3},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u767b\u5f55\u7ba1\u7406\u5e73\u53f0\uff0c\u8fdb\u5165 \u201c\u96c6\u7fa4\u7ba1\u7406\u201d\uff0c\u70b9\u51fb\u201c\u6dfb\u52a0\u96c6\u7fa4\u201d\u3002")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u8f93\u5165\u96c6\u7fa4\u540d\u79f0\uff0c\u6309\u9700\u4fee\u6539\u96c6\u7fa4\u540e\u7f00\uff0c\u8fd9\u91cc\u4f7f\u7528\u201cAPI Token\u201d\u65b9\u5f0f\u63a5\u5165\u96c6\u7fa4\u3002"))),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"API Host\uff0c\u4f7f\u7528\u652f\u6301 OIDC \u534f\u8bae\u7684 K8s API \u5730\u5740\uff0c\u53ef\u4ee5\u901a\u8fc7 ",(0,a.kt)("strong",{parentName:"li"},"kubectl get ingress -nu4a-system")," \u67e5\u770bkube-oidc-proxy-server-ingress \u5bf9\u5e94\u7684 Host \u4fe1\u606f\uff0c\u6bd4\u5982 ",(0,a.kt)("a",{parentName:"li",href:"https://k8s.172.22.96.136.nip.io"},"https://k8s.172.22.96.136.nip.io")),(0,a.kt)("li",{parentName:"ul"},"API Token\uff0c\u8f93\u5165\u7b2c 2 \u6b65\u83b7\u53d6\u7684 token \u4fe1\u606f")),(0,a.kt)("ol",{start:5},(0,a.kt)("li",{parentName:"ol"},'\u6dfb\u52a0\u6210\u529f\u540e\uff0c\u53ef\u4ee5\u5728\u5217\u8868\u4e0a\u770b\u5230\u96c6\u7fa4\u4fe1\u606f\u53ca\u5176\u72b6\u6001\uff1b\u9009\u62e9\u201c\u79df\u6237\u7ba1\u7406\u201d\uff0c\u4f1a\u770b\u5230\u540d\u79f0\u4e3a "system-tenant" \u7684\u4e00\u4e2a\u7cfb\u7edf\u79df\u6237')),(0,a.kt)("h2",{id:"\u6dfb\u52a0\u6258\u7ba1\u96c6\u7fa4"},"\u6dfb\u52a0\u6258\u7ba1\u96c6\u7fa4"),(0,a.kt)("p",null,"\u5047\u8bbe\u76ee\u524d\u5df2\u6709\u4e00\u4e2a Kubernetes \u96c6\u7fa4\uff0c\u901a\u8fc7 tde \u90e8\u7f72\u6216\u8005\u662f\u7b2c\u4e09\u65b9\u7684 Kubernetes \u96c6\u7fa4\uff0c\u5e0c\u671b\u52a0\u5165\u7ba1\u7406\u5e73\u53f0"),(0,a.kt)("h3",{id:"21-\u57fa\u7840\u96c6\u7fa4\u7ec4\u4ef6\u90e8\u7f72"},"2.1 \u57fa\u7840\u96c6\u7fa4\u7ec4\u4ef6\u90e8\u7f72"),(0,a.kt)("p",null,"\u96c6\u7fa4\u7ba1\u7406\u5458\u64cd\u4f5c\uff0c\u6216\u8005\u901a\u8fc7\u5bf9\u5e94\u7684\u5bb9\u5668 PaaS \u5e73\u53f0\u8fdb\u884c\u90e8\u7f72\u3002"),(0,a.kt)("p",null,"1\u3001\u4f7f\u7528 cluster-component \u8fd9\u4e2a helm \u5305\uff0c\u6839\u636e\u9700\u8981\u5bf9 values.yaml \u8fdb\u884c\u4fee\u6539\u3002\u4e00\u822c\u60c5\u51b5\u53ea\u9700\u8981\u4fee\u6539\u955c\u50cf\u4ed3\u5e93\u7684\u5730\u5740\uff0c\u4e5f\u5c31\u662f\u5c06 172.22.96.34 \u66ff\u6362\u4e3a\u4e3b\u96c6\u7fa4\u80fd\u591f\u8bbf\u95ee\u7684\uff0c\u5df2\u7ecf\u4e0a\u4f20\u597d\u76f8\u5173\u4f9d\u8d56\u955c\u50cf\u7684\u955c\u50cf\u4ed3\u5e93\u5730\u5740\u3002"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"ingress nginx \u4f1a\u7ed1\u5b9a\u5230\u5bf9\u5e94\u8282\u70b9\uff0c\u4ee5\u4fbf\u5728\u6307\u5b9a\u8282\u70b9\u63d0\u4f9b\u96c6\u7fa4\u5916\u8bbf\u95ee\u5730\u5740\uff0c\u6240\u4ee5\u9700\u8981\u4fee\u6539 deployedHost"),(0,a.kt)("li",{parentName:"ul"},"ingress nginx \u4f1a\u5360\u7528\u4e3b\u673a\u7684 80\u3001443 \u7aef\u53e3\uff0c\u4fdd\u8bc1 ingress nginx \u6240\u5728\u4e3b\u673a\u7aef\u53e3\u672a\u88ab\u5360\u7528")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'### values.yaml \u793a\u4f8b\n# Overwrite ingress-nginx chart template\ningress-nginx:\n  enabled: true\n  # MUST update this value\n  deployedHost: &deployedHost\n    tc-build-1.22\n  controller:\n    ingressClassResource:\n      name: portal-ingress\n    ingressClass: portal-ingress\n    image:\n      repository: hub.tenxcloud.com/cluster_system/ingress-nginx-controller\n      tag: "v1.3.0"\n    admissionWebhooks:\n      enabled: false\n      patch:\n        enabled: true\n        image:\n          registry: hub.tenxcloud.com\n          image: cluster_system/kube-webhook-certgen\n          tag: "0.30.0"\n          digest: ""\n    updateStrategy:\n      type: Recreate\n    extraArgs:\n      update-status: false\n      report-node-internal-ip-address: false\n      http-port: 8080\n      https-port: 8443\n      enable-ssl-passthrough: true\n      # it\'ll be 442 by default\n      ssl-passthrough-proxy-port: 8442\n    service:\n      enabled: false\n      type: ClusterIP\n      internal:\n        enabled: true\n    config:\n      use-gzip: "true"\n      enable-vts-status: "true"\n      large-client-header-buffers: 4 1m\n      max-worker-connections: "65535"\n      vts-default-filter-key: $server_name\n      worker-processes: "4"\n      http-snippet: |\n        proxy_cache_path /tmp/bff-cache levels=1:2 keys_zone=static-cache:2m max_size=100m inactive=7d use_temp_path=off;\n        proxy_cache_key $scheme$proxy_host$request_uri;\n        proxy_cache_lock on;\n        proxy_cache_use_stale updating;\n    nodeSelector:\n      kubernetes.io/os: linux\n      # MUST update this value\n      kubernetes.io/hostname: *deployedHost\n\ncert-manager:\n  enabled: true\n  # Required: Cert manager for certificate management\n  image: hub.tenxcloud.com/cluster_system/cert-manager-controller:v1.8.0\n  caInjectorImage: hub.tenxcloud.com/cluster_system/cert-manager-cainjector:v1.8.0\n  webhookImage: hub.tenxcloud.com/cluster_system/cert-manager-webhook:v1.8.0\n')),(0,a.kt)("p",null,"2\u3001\u8fd0\u884c helm \u547d\u4ee4\u90e8\u7f72\uff0c\u9ed8\u8ba4\u90e8\u7f72\u5728 cluster-system \u4e0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl create ns cluster-system\n# \u65b9\u5f0f\u4e00\uff1a\u89e3\u538b helm \u5305\uff0c\u4fee\u6539\u89e3\u538b\u540e\u7684 values.yaml\nhelm install cluster-component --namespace cluster-system .\n# \u65b9\u5f0f\u4e8c\uff1a\u4f7f\u7528 helm \u5305\u90e8\u7f72\nhelm install cluster-component --namespace cluster-system ./cluster-system-0.1.0.tgz -f values.yaml\n")),(0,a.kt)("h3",{id:"22-\u90e8\u7f72\u79df\u6237\u7ec4\u4ef6"},"2.2 \u90e8\u7f72\u79df\u6237\u7ec4\u4ef6"),(0,a.kt)("p",null,"1\u3001\u4f7f\u7528 u4a-component \u8fd9\u4e2a helm \u5305\uff0c\u6839\u636e\u9700\u8981\u5bf9 ",(0,a.kt)("strong",{parentName:"p"},"managed-cluster-values.yaml")," \u8fdb\u884c\u4fee\u6539\uff0c\u9700\u8981\u4fee\u6539\u4ee5\u4e0b\u914d\u7f6e\u4fe1\u606f\uff1a"),(0,a.kt)("p",null,"1\uff09\u66ff\u6362\u6240\u6709\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"<replaced-ingress-nginx-ip>")," \u4e3a ingress nginx \u7684\u66b4\u9732\u5730\u5740"),(0,a.kt)("p",null,"2\uff09\u66ff\u6362 registryServer \u4e3a\u672c\u5730\u4ed3\u5e93"),(0,a.kt)("p",null,"3\uff09\u66ff\u6362 issuerUrl \u4e3a\u53ef\u7528\u7684 OIDC issuer \u670d\u52a1\u5730\u5740\uff1b\u5982\u679c\u65e0\u6cd5\u89e3\u6790 nip.io \u7684 OIDC issuer \u7684\u5730\u5740\uff0c\u9700\u914d\u7f6e hostAliases"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"registryServer: &registryServer docker.io\n\naddon-component:\n  enabled: true\n  clusterResPrefix: managed\n  tenantManagement:\n    registryServer: *registryServer\n    image: kubebb/capsule-ce:v0.1.2-20221122\n  kubeOidcProxy:\n    registryServer: *registryServer\n    image: kubebb/kube-oidc-proxy-ce:v0.3.0-20221008\n    issuerUrl: https://portal.<oidc-server>.nip.io/oidc\n    clientId: bff-client\n    ingress:\n      enabled: true\n      name: portal-ingress\n      host: managed-k8s.<replaced-ingress-nginx-ip>.nip.io\n    certificate:\n      ipAddresses:\n        # MUST update this value to the host ip of kube-oidc-proxy\n        - <replaced-ingress-nginx-ip>\n      dnsNames:\n        - kube-oidc-proxy\n        - kube-oidc-proxy.u4a-system\n        - kube-oidc-proxy.u4a-system.svc\n    hostConfig:\n      enabled: false\n      hostAliases:\n        - hostnames:\n            # MUST update this value\n            - portal.<oidc-server>.nip.io\n          # MUST update this value\n          ip: <oidc-server>\n")),(0,a.kt)("p",null,"2\u3001\u8fd0\u884c helm \u547d\u4ee4\u90e8\u7f72\uff0c\u9ed8\u8ba4\u90e8\u7f72\u5728 cluster-system \u4e0b"),(0,a.kt)("p",null,"\u4ee5\u4e0b\u547d\u4ee4\u5728\u7ba1\u7406\u96c6\u7fa4\u64cd\u4f5c\uff0c\u83b7\u53d6 oidc server \u7684 secret\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# \u5bfc\u51fa\u6240\u9700\u7684 secret\nkubectl get secret oidc-server-root-secret  -n u4a-system -o yaml > oidc-server-root-secret.yaml\n")),(0,a.kt)("p",null,"\u4f7f\u7528 oidc-server-root-secret.yaml \u5728\u5f85\u63a5\u5165\u96c6\u7fa4\u64cd\u4f5c\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# \u5207\u6362\u5230\u5f85\u63a5\u5165\u96c6\u7fa4\uff0c\u5e76\u521b\u5efa\u5bf9\u5e94\u7684 secret \u8d44\u6e90\nkubectl apply -f oidc-server-root-secret.yaml\n\n# \u751f\u6210 oidc-proxy \u7684\u8bc1\u4e66\n# \u65b9\u6cd5\u4e00. \u57fa\u4e8e Kubernetes \u7684 ca \u8bc1\u4e66\u751f\u6210\n# \u8fdb\u5165 Kubernetes \u7684\u8bc1\u4e66\u76ee\u5f55\uff0c\u4e00\u822c\u4e3a /etc/kubernetes/pki/\ncd /etc/kubernetes/pki/\n# \u521b\u5efa\u5bf9\u5e94 secret\nkubectl create secret tls -n u4a-system oidc-proxy-cert-tls --cert=ca.crt --key=ca.key\n# \u65b9\u6cd5\u4e8c. \u53c2\u8003 http://kubebb.k8s.com.cn/docs/building-base/configuration/issue-oidc-proxy-certs \u751f\u6210\u8bc1\u4e66\n\n# \u90e8\u7f72 u4a-component\n# \u65b9\u5f0f\u4e00\uff1a\u89e3\u538b helm \u5305\uff0c\u4fee\u6539\u89e3\u538b\u540e\u7684 values.yaml\uff08\u9700\u8981\u6307\u5b9a --wait\uff0c\u7b49\u5f85\u6240\u6709\u8d44\u6e90 ready \u540e\u624d\u6267\u884c post-install \u52a8\u4f5c\uff0c\u5982\u679c\u957f\u65f6\u95f4\u65e0\u54cd\u5e94\uff0c\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b\u5bf9\u5e94\u7684 pod \u72b6\u6001\u67e5\u770b\u5177\u4f53\u60c5\u51b5\uff09\nhelm install --wait u4a-component --namespace u4a-system  . -f managed-cluster-values.yaml\n# \u65b9\u5f0f\u4e8c\uff1a\u4f7f\u7528 helm \u5305\u90e8\u7f72\nhelm install --wait u4a-component --namespace u4a-system ./u4a-component-v5.7.0.tgz -f managed-cluster-values.yaml\n\n# \u786e\u8ba4\u670d\u52a1\u5747\u542f\u52a8\u6210\u529f\nkubectl get pods -n u4a-system\n\n# \u91cd\u542f capsule-controller-manager \u6765\u52a0\u8f7d\u65b0\u7684 CapsuleConfiguration \u914d\u7f6e\nkubectl delete pod -n u4a-system $(kubectl get pods -n u4a-system | grep capsule-controller-manager | awk '{print $1}')\n")),(0,a.kt)("h3",{id:"23-\u6dfb\u52a0\u96c6\u7fa4"},"2.3 \u6dfb\u52a0\u96c6\u7fa4"),(0,a.kt)("p",null,"1\u3001\u83b7\u53d6\u6240\u9700\u7684\u63a5\u5165\u96c6\u7fa4\u7684 token"),(0,a.kt)("p",null,"   \u5982\u679c\u96c6\u7fa4\u7684\u7248\u672c\u662f kbuernetes v1.24 \u53ca\u4ee5\u4e0a\u7684\u7248\u672c\uff0c\u4e0a\u9762\u7684 cluster-reader serviceAccount \u7684 token \u4e0d\u4f1a\u81ea\u52a8\u751f\u6210\uff0c\u9700\u8981\u624b\u52a8\u521b\u5efa\uff0c\u5982\u7eb3\u7ba1\u96c6\u7fa4\u7684 serviceAccount \u7684\u540d\u79f0\u4e3a managed-cluster-reader\uff0c\u521b\u5efa\u6b64 serviceAccount \u7684 secret \u7684 yaml \u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: Secret\ntype: kubernetes.io/service-account-token\nmetadata:\n  name: managed-cluster-reader\n  namespace: addon-system\n  annotations:\n    kubernetes.io/service-account.name: "managed-cluster-reader"\n')),(0,a.kt)("p",null,"\u6ce8\u610f\uff1a\u82e5 secret \u624b\u52a8\u521b\u5efa\u7684\uff0csecret \u540d\u79f0\u4e3a managed-cluster-reader "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"# \u786e\u8ba4\u5bf9\u5e94 token \u5b58\u5728\nkubectl get secret -n u4a-system | grep cluster-reader\n# \u5bfc\u51fa\u8be5 secret\uff0c\u6bd4\u5982'managed-cluster-reader-secret'\nkubectl get secret managed-cluster-reader-secret -n u4a-system -o yaml > managed-cluster-reader-secret.yaml\n")),(0,a.kt)("p",null,"2\u3001\u590d\u5236\u5230\u201c\u4e3b\u96c6\u7fa4\u201d\u4e0a\uff0c\u5e76\u521b\u5efa\u8be5 secret"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"# \u7f16\u8f91 yaml\uff0c\u5220\u9664 secret \u91cc\u7684 type: kubernetes.io/service-account-token\nkubectl apply -f managed-cluster-reader-secret.yaml\n")),(0,a.kt)("p",null,"3\u3001\u65b0\u5efa cluster \u8d44\u6e90\uff0c\u6bd4\u5982 managed-cluster.yaml\uff08\u4e5f\u53ef\u4ee5\u767b\u5f55\u540e\u901a\u8fc7\u9875\u9762\u6dfb\u52a0\uff0c\u767b\u5f55\u7528\u6237\u9700\u5177\u5907\u5bf9\u5e94\u6743\u9650\uff0c\u5e76\u4f7f\u7528 secret \u91cc\u7684 token \u8fdb\u884c\u6dfb\u52a0\uff09"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"# Create cluster model on host cluster ONLY for now\napiVersion: cluster.karmada.io/v1alpha1\nkind: Cluster\nmetadata:\n  annotations:\n    displayName: managerd-cluster\n  name: managed-cluster\nspec:\n  syncMode: Pull\n  # 1. \u5982\u679c\u901a\u8fc7 kube-oidc-proxy \u8fdb\u884c\u4e86\u4ee3\u7406\uff0c\u5219\u9700\u8981\u4f7f\u7528 kube-oidc-proxy \u7684\u5730\u5740\uff0c\u6bd4\u5982 https://192.168.1.123\n  # 2. \u542f\u7528\u4e86 OIDC \u7684 K8S api \u7684\u8bbf\u95ee\u5730\u5740\uff0c\u6bd4\u5982 https://192.168.1.123:6443\n  apiEndpoint: managed-k8s.192.168.1.123.nip.io\n  secretRef:\n    # Update as needed\n    namespace: cluster-system\n    # Must update the info of secret reference\n    # Run 'kubectl get secret -n cluster-system | grep managed-cluster' to get the secret\n    name: managed-cluster-reader-secret\n  # Update as needed\n  provider: tenxcloud\n  region: default\n  zone: managed-zone\n")),(0,a.kt)("p",null,"\u521b\u5efa cluster"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"kubectl apply -f managed-cluster.yaml\n")))}m.isMDXComponent=!0}}]);